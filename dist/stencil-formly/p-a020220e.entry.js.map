{"version":3,"names":["fieldDocsCss","FieldDocs","calendarHandler","newValue","_oldValue","this","docs","async","value","Array","from","promises","push","loadScript","loadCss","Promise","all","FilePond","registerPlugin","FilePondPluginImagePreview","FilePondPluginFileValidateType","setOptions","name","server","url","process","method","withCredentials","headers","toto","timeout","onload","response","console","log","JSON","parse","success","thumb","customChange","emit","onerror","ondata","fetch","revert","componentDidRender","inputElement","document","querySelector","pond","create","acceptedFileTypes","on","error","file","removeFile","id","renderInput","h","type","multiple","removeDoc","index","splice","renderDocs","length","stringify","class","map","element","src","style","onClick","displayRequired","_a","templateOptions","required","_b","render"],"sources":["./src/components/dynamic-form/fields/field-docs.css?tag=field-docs","./src/components/dynamic-form/fields/field-docs.tsx"],"sourcesContent":[".filepond--item {\n  width: calc(25% - 0.5em);\n}\n\n.df-docs-container {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: row;\n  align-items: center;\n}\n","import { Component, h, State, Prop, Event, EventEmitter, Watch } from '@stencil/core';\n\nimport { loadScript, loadCss, loadModule, loadNoModule } from '../../../utils/loadScript';\n\ndeclare var FilePond: any;\ndeclare var FilePondPluginImagePreview: any;\ndeclare var FilePondPluginFileValidateType: any;\n\n@Component({\n  tag: 'field-docs',\n  styleUrl: 'field-docs.css',\n})\nexport class FieldDocs {\n  displayRequired;\n\n  @Prop() value: any;\n  @Prop() disabled = false;\n  @Prop() templateOptions: any = {};\n\n  @State() docs = [];\n\n  @Event() customChange: EventEmitter<any>;\n\n  @Watch('value')\n  calendarHandler(newValue: any, _oldValue: any) {\n    this.docs = [...newValue];\n  }\n\n  async componentWillLoad() {\n    if (this.value) {\n      this.docs = Array.from(this.value);\n    }\n\n    let promises = [];\n\n    promises.push(loadScript('https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js'));\n    promises.push(loadScript('https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js'));\n    promises.push(loadCss('https://unpkg.com/filepond@^4/dist/filepond.css'));\n    promises.push(loadCss('https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css'));\n\n    promises.push(loadScript('https://unpkg.com/filepond@^4/dist/filepond.js'));\n\n    await Promise.all(promises);\n\n    FilePond.registerPlugin(FilePondPluginImagePreview);\n    FilePond.registerPlugin(FilePondPluginFileValidateType);\n\n    FilePond.setOptions({\n      name: 'file',\n      server: {\n        url: 'http://localhost:3333/api/files',\n        process: {\n          url: '/upload',\n          method: 'POST',\n          withCredentials: false,\n          headers: { toto: 'toto' },\n          timeout: 7000,\n          onload: response => {\n            console.log('response', response);\n            response = JSON.parse(response);\n            if (response.success == true && response.thumb && response.url) {\n              let docs = [...this.docs, { thumb: response.thumb, url: response.url }];\n\n              this.customChange.emit({ value: docs });\n            }\n          },\n          onerror: null,\n          ondata: null,\n        },\n        fetch: null,\n        revert: null,\n      },\n    });\n  }\n\n  componentDidRender() {\n    const inputElement = document.querySelector('input[type=\"file\"]');\n\n    const pond = FilePond.create(inputElement, {\n      acceptedFileTypes: ['image/*', 'application/pdf'],\n    });\n\n    pond.on('processfile', (error, file) => {\n      pond.removeFile(file.id);\n    });\n  }\n\n  renderInput() {\n    return <input type=\"file\" multiple />;\n  }\n\n  removeDoc(index) {\n    this.docs.splice(index, 1);\n    this.customChange.emit({ value: this.docs });\n  }\n\n  renderDocs() {\n    if (this.docs.length > 0) {\n      console.log('render docs', JSON.stringify(this.docs));\n      return (\n        <div class=\"df-docs-container\">\n          {this.docs.map((element, index) => {\n            return (\n              <div>\n                <img src={element.thumb} style={{ 'margin-left': '10px' }}></img>\n                <button\n                  class=\"delete is-small df-is-required\"\n                  onClick={() => {\n                    console.log('this.docs', this.docs);\n                    this.removeDoc(index);\n                  }}\n                ></button>\n              </div>\n            );\n          })}\n        </div>\n      );\n    }\n  }\n\n  async componentWillRender() {\n    this.displayRequired = this.templateOptions?.required == true && this.docs?.length == 0;\n  }\n\n  render() {\n    return (\n      <field-container templateOptions={this.templateOptions} displayRequired={this.displayRequired}>\n        {this.renderInput()}\n      </field-container>\n    );\n  }\n}\n"],"mappings":"wFAAA,MAAMA,EAAe,gI,MCYRC,EAAS,M,uGAID,M,qBACY,G,UAEf,E,CAKhBC,gBAAgBC,EAAeC,GAC7BC,KAAKC,KAAO,IAAIH,E,CAGlBI,0BACE,GAAIF,KAAKG,MAAO,CACdH,KAAKC,KAAOG,MAAMC,KAAKL,KAAKG,M,CAG9B,IAAIG,EAAW,GAEfA,EAASC,KAAKC,EAAW,oGACzBF,EAASC,KAAKC,EAAW,0FACzBF,EAASC,KAAKE,EAAQ,oDACtBH,EAASC,KAAKE,EAAQ,2FAEtBH,EAASC,KAAKC,EAAW,yDAEnBE,QAAQC,IAAIL,GAElBM,SAASC,eAAeC,4BACxBF,SAASC,eAAeE,gCAExBH,SAASI,WAAW,CAClBC,KAAM,OACNC,OAAQ,CACNC,IAAK,kCACLC,QAAS,CACPD,IAAK,UACLE,OAAQ,OACRC,gBAAiB,MACjBC,QAAS,CAAEC,KAAM,QACjBC,QAAS,IACTC,OAAQC,IACNC,QAAQC,IAAI,WAAYF,GACxBA,EAAWG,KAAKC,MAAMJ,GACtB,GAAIA,EAASK,SAAW,MAAQL,EAASM,OAASN,EAASR,IAAK,CAC9D,IAAIlB,EAAO,IAAID,KAAKC,KAAM,CAAEgC,MAAON,EAASM,MAAOd,IAAKQ,EAASR,MAEjEnB,KAAKkC,aAAaC,KAAK,CAAEhC,MAAOF,G,GAGpCmC,QAAS,KACTC,OAAQ,MAEVC,MAAO,KACPC,OAAQ,O,CAKdC,qBACE,MAAMC,EAAeC,SAASC,cAAc,sBAE5C,MAAMC,EAAOhC,SAASiC,OAAOJ,EAAc,CACzCK,kBAAmB,CAAC,UAAW,qBAGjCF,EAAKG,GAAG,eAAe,CAACC,EAAOC,KAC7BL,EAAKM,WAAWD,EAAKE,GAAG,G,CAI5BC,cACE,OAAOC,EAAA,SAAOC,KAAK,OAAOC,SAAQ,M,CAGpCC,UAAUC,GACRzD,KAAKC,KAAKyD,OAAOD,EAAO,GACxBzD,KAAKkC,aAAaC,KAAK,CAAEhC,MAAOH,KAAKC,M,CAGvC0D,aACE,GAAI3D,KAAKC,KAAK2D,OAAS,EAAG,CACxBhC,QAAQC,IAAI,cAAeC,KAAK+B,UAAU7D,KAAKC,OAC/C,OACEoD,EAAA,OAAKS,MAAM,qBACR9D,KAAKC,KAAK8D,KAAI,CAACC,EAASP,IAErBJ,EAAA,WACEA,EAAA,OAAKY,IAAKD,EAAQ/B,MAAOiC,MAAO,CAAE,cAAe,UACjDb,EAAA,UACES,MAAM,iCACNK,QAAS,KACPvC,QAAQC,IAAI,YAAa7B,KAAKC,MAC9BD,KAAKwD,UAAUC,EAAM,O,EAWvCvD,4B,QACEF,KAAKoE,kBAAkBC,EAAArE,KAAKsE,mBAAe,MAAAD,SAAA,SAAAA,EAAEE,WAAY,QAAQC,EAAAxE,KAAKC,QAAI,MAAAuE,SAAA,SAAAA,EAAEZ,SAAU,C,CAGxFa,SACE,OACEpB,EAAA,mBAAiBiB,gBAAiBtE,KAAKsE,gBAAiBF,gBAAiBpE,KAAKoE,iBAC3EpE,KAAKoD,c"}
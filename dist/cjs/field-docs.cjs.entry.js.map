{"file":"field-docs.entry.cjs.js","mappings":"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","names":["loadScript","loadCss","h","index"],"sources":["./src/components/dynamic-form/fields/field-docs.css?tag=field-docs","./src/components/dynamic-form/fields/field-docs.tsx"],"sourcesContent":[".filepond--item {\n  width: calc(25% - 0.5em);\n}\n\n.df-docs-container {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: row;\n  align-items: center;\n}\n","import { Component, h, State, Prop, Event, EventEmitter, Watch } from '@stencil/core';\n\nimport { loadScript, loadCss, loadModule, loadNoModule } from '../../../utils/loadScript';\n\ndeclare var FilePond: any;\ndeclare var FilePondPluginImagePreview: any;\ndeclare var FilePondPluginFileValidateType: any;\n\n@Component({\n  tag: 'field-docs',\n  styleUrl: 'field-docs.css',\n})\nexport class FieldDocs {\n  displayRequired;\n\n  @Prop() value: any;\n  @Prop() disabled = false;\n  @Prop() templateOptions: any = {};\n\n  @State() docs = [];\n\n  @Event() customChange: EventEmitter<any>;\n\n  @Watch('value')\n  calendarHandler(newValue: any, _oldValue: any) {\n    this.docs = [...newValue];\n  }\n\n  async componentWillLoad() {\n    if (this.value) {\n      this.docs = Array.from(this.value);\n    }\n\n    let promises = [];\n\n    promises.push(loadScript('https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js'));\n    promises.push(loadScript('https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js'));\n    promises.push(loadCss('https://unpkg.com/filepond@^4/dist/filepond.css'));\n    promises.push(loadCss('https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css'));\n\n    promises.push(loadScript('https://unpkg.com/filepond@^4/dist/filepond.js'));\n\n    await Promise.all(promises);\n\n    FilePond.registerPlugin(FilePondPluginImagePreview);\n    FilePond.registerPlugin(FilePondPluginFileValidateType);\n\n    FilePond.setOptions({\n      name: 'file',\n      server: {\n        url: 'http://localhost:3333/api/files',\n        process: {\n          url: '/upload',\n          method: 'POST',\n          withCredentials: false,\n          headers: { toto: 'toto' },\n          timeout: 7000,\n          onload: response => {\n            console.log('response', response);\n            response = JSON.parse(response);\n            if (response.success == true && response.thumb && response.url) {\n              let docs = [...this.docs, { thumb: response.thumb, url: response.url }];\n\n              this.customChange.emit({ value: docs });\n            }\n          },\n          onerror: null,\n          ondata: null,\n        },\n        fetch: null,\n        revert: null,\n      },\n    });\n  }\n\n  componentDidRender() {\n    const inputElement = document.querySelector('input[type=\"file\"]');\n\n    const pond = FilePond.create(inputElement, {\n      acceptedFileTypes: ['image/*', 'application/pdf'],\n    });\n\n    pond.on('processfile', (error, file) => {\n      pond.removeFile(file.id);\n    });\n  }\n\n  renderInput() {\n    return <input type=\"file\" multiple />;\n  }\n\n  removeDoc(index) {\n    this.docs.splice(index, 1);\n    this.customChange.emit({ value: this.docs });\n  }\n\n  renderDocs() {\n    if (this.docs.length > 0) {\n      console.log('render docs', JSON.stringify(this.docs));\n      return (\n        <div class=\"df-docs-container\">\n          {this.docs.map((element, index) => {\n            return (\n              <div>\n                <img src={element.thumb} style={{ 'margin-left': '10px' }}></img>\n                <button\n                  class=\"delete is-small df-is-required\"\n                  onClick={() => {\n                    console.log('this.docs', this.docs);\n                    this.removeDoc(index);\n                  }}\n                ></button>\n              </div>\n            );\n          })}\n        </div>\n      );\n    }\n  }\n\n  async componentWillRender() {\n    this.displayRequired = this.templateOptions?.required == true && this.docs?.length == 0;\n  }\n\n  render() {\n    return (\n      <field-container templateOptions={this.templateOptions} displayRequired={this.displayRequired}>\n        {this.renderInput()}\n      </field-container>\n    );\n  }\n}\n"],"version":3}